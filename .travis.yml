os: osx
osx_image: xcode10.2
language: objective-c
sudo: false
env:
  global:
  - THEOS=~/theos
before_install:
- brew update
- brew install dpkg ldid
- git clone --recursive git://github.com/theos/theos.git ~/theos
script:
- 'export VERSION=$(grep ''Version: '' control | sed ''s/^.*: //'')'
- export DESCRIPTION=$(awk '/## v$VERSION/{getline; print}' README.md)
- 'export FILENAME=''packages/''"$(grep ''Package: '' control | sed ''s/^.*: //'')"''_''"$VERSION"''_iphoneos-arm.deb'''
- make package
before_deploy:
- git config --local user.name "Jeff Rescignano"
- git config --local user.email "jeff@jeffresc.dev"
- git tag -a v$VERSION -m "$DESCRIPTION"
deploy:
  provider: releases
  api_key:
    secure: AK2gTHQFf9t2m26rpyqBBSAarklQKuq6KYVx+HTohDCmZTf5BY2XH41U2ptHsXfI+4VRCnAX2yQvSi+J8u62iGzOwNQ94WPAztRzRW8FxDRSZF9lmGKOFjO9AYM/HsjBBLgVKx0qF0ORK+i3LoXgARfctxEA2w21vXX61tsHdo5Xje8xw3bV/l3HUWs9msPV2aqZQFIDbWg5x7v8Bqs3bx07G5u0ztjvDXxxynvsAAfp/gLqPR1m7zLwltGGIdGMJUd+MwLPTr9c6pMb6o64zotiMiO08mUOyczqW6l5s5URZAGLqa53YCccvX8z3vEmxKIU+kuqZBYECxQbHe8aXXbXbToGRQBRD07/Jrt4ARhYEWCu0iFUaFQSVDRaQeGRTNrUdFR4JKndpNNoO4VaYqQJ8GXSBfevzqPofatZQG5QtjpvDsvAaZ9AKt6TjB5kr4+kaHO4mWCtJIpXOAam0chCno4etWGraL8mMMpbdWfKs+avkvPlXMXDOdlOwUfo/+rqqeWV6KPSlPlhDNRwpnMMRgMpqYE3RuAuVTHrEeLOYDeFPhndeNOAZISBpzo+TN1BliMUcUEyV/FNmSqxCeK5UU1Iq2Nkojt1su0t37hxKCJaZiFIGKS0QgK7lpRhsPJXX2j/YCUzCW+GQVtpaksLTpjf2R7MfkT5z5sWFz8=
  file: $FILENAME
  skip_cleanup: true
  on:
    branches:
      only:
        - release
